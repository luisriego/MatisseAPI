{% extends 'admin/layout.html.twig' %}

{% block title %}Tipos de Despesa{% endblock %}

{% block page_title %}{{ page_title_text|default('Lista de Tipos de Despesa') }}{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item active" aria-current="page">Tipos de Despesa</li>
{% endblock %}

{% block page_actions %}
    {# Esta ruta debe apuntar al controlador que muestra el formulario de creación (GET) #}
    <a href="{{ path('admin_expense_type_new') }}" class="btn btn-primary">
        <twig:ux:icon name="tabler:plus" class="me-1"/> Novo Tipo de Despesa
    </a>
{% endblock %}

{# --- Layout Customizations for this page --- #}
{% block main_column_class %}col-12{% endblock %} {# Contenido a ancho completo #}
{% block sidebar %}{% endblock %} {# Sin sidebar #}
{# --- End Layout Customizations --- #}

{% block admin_page_content %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title mb-0">Todos os Tipos de Despesa</h3>
            {# Podrías añadir filtros aquí si es necesario en el futuro #}
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead>
                <tr>
                    <th>Código</th>
                    <th>Nome</th>
                    <th>Descrição</th>
                    <th>Método Distrib.</th>
                    <th>Recorrente?</th>
                    <th style="width: 15%;" class="text-end">Ações</th>
                </tr>
                </thead>
                <tbody>
                {% for type in expense_types %}
                    <tr>
                        <td>{{ type.code()|default('N/A') }}</td>
                        <td>{{ type.name()|default('N/A') }}</td>
                        <td>{{ type.description()|slice(0, 70)|default('') }}{{ type.description()|length > 70 ? '...' : '' }}</td>
                        <td>
                            {% if type.distributionMethod() == constant('App\\Entity\\ExpenseType::EQUAL') %}
                                Igualitário
                            {% elseif type.distributionMethod() == constant('App\\Entity\\ExpenseType::FRACTION') %}
                                Fração
                            {% elseif type.distributionMethod() == constant('App\\Entity\\ExpenseType::INDIVIDUAL') %}
                                Individual
                            {% else %}
                                {{ type.distributionMethod()|default('N/D') }}
                            {% endif %}
                        </td>
                        <td>
                            {% if type.isRecurring() %}
                                <span class="badge bg-success">Sim</span>
                            {% else %}
                                <span class="badge bg-secondary">Não</span>
                            {% endif %}
                        </td>
                        <td class="text-end">
                            {# La ruta 'admin_expense_type_edit' necesitará ser creada #}
                            <a href="/" class="btn custom-btn-xs btn-outline-primary me-1" title="Editar">
                                <twig:ux:icon name="tabler:edit"/>
                            </a>
                            {# La ruta 'admin_expense_type_delete' necesitará ser creada #}
                            <form action="{{ path('admin_expense_type_new', { id: type.id() }) }}" method="post" class="d-inline" onsubmit="return confirm('Tem certeza que deseja excluir este tipo de despesa? Esta ação não pode ser desfeita.');">
                                <input type="hidden" name="_method" value="DELETE">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ type.id()) }}">
                                <button type="submit" class="btn custom-btn-xs btn-outline-danger" title="Excluir">
                                    <twig:ux:icon name="tabler:trash"/>
                                </button>
                            </form>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-4">
                            <p class="mb-1">Nenhum tipo de despesa encontrado.</p>
                            <a href="{{ path('admin_expense_type_new') }}" class="btn btn-sm btn-primary">
                                <twig:ux:icon name="tabler:plus" class="me-1"/> Criar o Primeiro Tipo de Despesa
                            </a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {# Podrías añadir paginación aquí si la lista es muy larga #}
        {# {% if expense_types.haveToPaginate %}
            <div class="card-footer">
                {{ knp_pagination_render(expense_types) }}
            </div>
        {% endif %} #}
    </div>
{% endblock %}
